<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Payizi Global - Secure international money transfer service" />
  <meta name="author" content="Payizi Global" />
  <title>Payizi Order Form</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Roboto+Mono&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="container">
      <!-- Logo/Brand Section -->
      <div class="navbar-brand">
        <img src="white_icon_transparent_background.png" alt="Payizi Global Logo" class="navbar-logo">
        <span class="brand-text">Payizi Global</span>
      </div>
      
      <!-- Mobile Menu Toggle Button -->
      <button class="navbar-toggler-alt collapsed d-md-none" type="button" aria-label="Toggle navigation">
        <div class="hamburger">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </button>
      
      <!-- Navigation Links -->
      <ul class="navbar-nav">
        <li class="nav-item"><a href="index.html" class="nav-link active">Home</a></li>
        <li class="nav-item"><a href="status.html" class="nav-link">Track Order</a></li>
        <li class="nav-item"><a href="contact.html" class="nav-link">Contact</a></li>
      </ul>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="container mt-4">
    <h2 class="text-center mb-4">
    
      My Payment Detail
    </h2>
    
    <!-- Enhanced Order Form with Validation -->
    <form id="orderForm" class="custom-form">
      
      <!-- Amount Details Section -->
      <section>
        <h4><i class="fas fa-dollar-sign me-2"></i>Amount Details</h4>
        
        <div class="form-group">
          <label for="usdAmount" class="form-label">USD Amount Required *</label>
          <div class="form-control-icon">
            <input type="number" class="form-control" id="usdAmount" name="usdAmount" step="5" min="5" max="10000" placeholder="100" required />
            <i class="form-icon fas fa-dollar-sign"></i>
            <i class="validation-icon valid fas fa-check-circle"></i>
            <i class="validation-icon invalid fas fa-exclamation-circle"></i>
          </div>
          <div class="form-text">Enter amount in multiples of 5 between $5 and $5,000</div>
        </div>
        
        <!-- Exchange Rate Display -->
        <div class="row mt-3">
          <div class="col-md-4">
            <div class="card h-100">
              <div class="card-body text-center">
                <h6 class="card-title text-muted">Exchange Rate</h6>
                <p class="h5 text-primary mb-0">
                  <i class="fas fa-exchange-alt me-1"></i>
                  <span id="rate">Loading...</span>
                </p>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card h-100">
              <div class="card-body text-center">
                <h6 class="card-title text-muted">Effective Rate</h6>
                <p class="h5 text-info mb-0">
                  <i class="fas fa-calculator me-1"></i>
                  <span id="effectiveRate">Loading...</span>
                </p>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card h-100">
              <div class="card-body text-center">
                <h6 class="card-title text-muted">ZAR Total</h6>
                <p class="h5 text-success mb-0">
                  <i class="fas fa-coins me-1"></i>
                  R<span id="zarTotal">0.00</span>
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Customer Information Section -->
      <section>
        <h4><i class="fas fa-user me-2"></i>Customer Information</h4>
        
        <div class="form-group">
          <label for="name" class="form-label">Full Name *</label>
          <div class="form-control-icon">
            <input type="text" class="form-control" id="name" name="name" placeholder="Enter your full name" required />
            <i class="form-icon fas fa-user"></i>
            <i class="validation-icon valid fas fa-check-circle"></i>
            <i class="validation-icon invalid fas fa-exclamation-circle"></i>
          </div>
          
        </div>
        
        <div class="form-group">
          <label for="email" class="form-label">Email Address *</label>
          <div class="form-control-icon">
            <input type="email" class="form-control" id="email" name="email" placeholder="your.email@example.com" required />
            <i class="form-icon fas fa-envelope"></i>
            <i class="validation-icon valid fas fa-check-circle"></i>
            <i class="validation-icon invalid fas fa-exclamation-circle"></i>
          </div>
          <div class="form-text">We'll send order confirmations to this email address</div>
        </div>
        
        <div class="form-group">
          <label for="mobile" class="form-label">Mobile Number (South Africa) *</label>
          <div class="form-control-icon">
            <input type="tel" class="form-control" id="mobile" name="mobile" placeholder="+27 82 1234 567" required />
            <i class="form-icon fas fa-mobile-alt"></i>
            <i class="validation-icon valid fas fa-check-circle"></i>
            <i class="validation-icon invalid fas fa-exclamation-circle"></i>
          </div>
          <div class="form-text">South African mobile number only (+27 XX XXX XXXX or 0XX XXX XXXX)</div>
        </div>
      </section>

      <!-- Beneficiary Information Section -->
      <section>
        <h4><i class="fas fa-user-friends me-2"></i>Beneficiary Information</h4>
        
        <div class="form-group">
          <label for="beneficiaryName" class="form-label">Beneficiary Name *</label>
          <div class="form-control-icon">
            <input type="text" class="form-control" id="beneficiaryName" name="beneficiaryName" placeholder="Full name of recipient" required />
            <i class="form-icon fas fa-user-friends"></i>
            <i class="validation-icon valid fas fa-check-circle"></i>
            <i class="validation-icon invalid fas fa-exclamation-circle"></i>
          </div>
         
        </div>
        
        <div class="form-group">
          <label for="beneficiaryMobile" class="form-label">Beneficiary Mobile (Zimbabwe) *</label>
          <div class="form-control-icon">
            <input type="tel" class="form-control" id="beneficiaryMobile" name="beneficiaryMobile" placeholder="+263 77 123 4567" required />
            <i class="form-icon fas fa-phone"></i>
            <i class="validation-icon valid fas fa-check-circle"></i>
            <i class="validation-icon invalid fas fa-exclamation-circle"></i>
          </div>
          <div class="form-text">Zimbabwean mobile number only (+263 7X XXX XXXX or 07X XXX XXXX)</div>
        </div>
        
        <div class="form-group">
          <label for="beneficiaryId" class="form-label">Government ID / Passport (Zimbabwe) *</label>
          <div class="form-control-icon">
            <input type="text" class="form-control" id="beneficiaryId" name="beneficiaryId" placeholder="12-345678A90 or AB123456" required />
            <i class="form-icon fas fa-id-card"></i>
            <i class="validation-icon valid fas fa-check-circle"></i>
            <i class="validation-icon invalid fas fa-exclamation-circle"></i>
          </div>
          <div class="form-text">
            Zimbabwean National ID: XX-XXXXXXX[A-Z]XX (e.g., 12-345678A90)<br>
            Zimbabwean Passport: XX000000 (2 letters + 6 numbers, e.g., AB123456)
          </div>
        </div>
        
        <div class="form-group">
          <label for="country" class="form-label">Receiving Country *</label>
          <div class="form-select-icon">
            <select class="form-select" id="country" name="country" required>
              <option value="">Select country...</option>
              <option value="Zimbabwe">Zimbabwe</option>
            </select>
            <i class="form-icon fas fa-globe-africa"></i>
          </div>
          
        </div>
        
        <div class="form-group">
          <label for="location" class="form-label">Pickup Location *</label>
          <div class="form-select-icon">
            <select class="form-select" id="location" name="location" required>
              <option value="">Select pickup location...</option>
              <option value="harare-livingstone">Harare - Livingstone Avenue</option>
              <option value="zhombe-joel">Zhombe - Joel</option>
              <option value="bulawayo-9th">Bulawayo - 9th Avenue</option>
            </select>
            <i class="form-icon fas fa-map-marker-alt"></i>
          </div>
          
        </div>
      </section>

      <!-- Form Buttons -->
      <div class="d-grid gap-2">
        <button type="submit" class="btn btn-primary btn-lg">
          <i class="fas fa-arrow-right me-2"></i>
          Proceed to Review
        </button>
        <button id="savePdfBtn" class="btn btn-outline-primary" type="button">
          <i class="fas fa-file-pdf me-2"></i>
          Save As PDF
        </button>
      </div>
    </form>

    <!-- Order Review Section -->
    <section id="reviewSection" class="mt-4" style="display:none">
      <div class="custom-form">
        <h4><i class="fas fa-clipboard-check me-2"></i>Order Review</h4>
        <div class="alert alert-info">
          <i class="fas fa-info-circle me-2"></i>
          Please review your order details carefully before confirming.
        </div>
        
        <pre id="reviewOutput" class="bg-light p-3 border rounded"></pre>

        <h5 class="mt-4">
          <i class="fas fa-university me-2"></i>
          Payment Instructions
        </h5>
        <div class="card">
          <div class="card-body">
            <div class="row">
              <div class="col-md-6">
                <p><strong><i class="fas fa-building me-2"></i>Bank:</strong> First National Bank</p>
                <p><strong><i class="fas fa-user-tie me-2"></i>Account Name:</strong> Payizi Global</p>
                <p><strong><i class="fas fa-hashtag me-2"></i>Account Number:</strong> 63077437200</p>
              </div>
              <div class="col-md-6">
                <p><strong><i class="fas fa-code-branch me-2"></i>Branch Code:</strong> 250655</p>
                <p><strong><i class="fas fa-receipt me-2"></i>Reference:</strong> <span id="orderRef" class="text-primary fw-bold"></span></p>
              </div>
            </div>
          </div>
        </div>

        <div class="d-flex justify-content-between flex-wrap gap-2 mt-4">
          <button id="backBtn" class="btn btn-secondary">
            <i class="fas fa-arrow-left me-2"></i>
            Back to Edit
          </button>
          <button id="confirmBtn" class="btn btn-success">
            <i class="fas fa-check me-2"></i>
            Confirm & Submit
          </button>
          <button id="pdfBtn" class="btn btn-outline-primary">
            <i class="fas fa-download me-2"></i>
            Download PDF
          </button>
        </div>
      </div>
    </section>

    <!-- Confirmation Message -->
    <div id="confirmation" class="alert alert-success mt-3" style="display:none">
      <i class="fas fa-check-circle me-2"></i>
      Order submitted and email sent successfully!
    </div>
  </main>

  <!-- Enhanced Footer -->
  <footer class="bg-dark text-white text-center py-4 mt-5">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <img src="white_icon_transparent_background.png" alt="Payizi Global" class="footer-logo">
          <h5 class="mb-3">Payizi Global</h5>
          <h4 class="text-warning mb-3">POWERING ZIMBABWE'S FINANCIAL FUTURE</h4>
          <p class="mb-2">Payizi makes sending money, paying bills, and supporting loved ones effortless.</p>
          <p class="mb-2">Join the fintech revolution built for Zimbabweans everywhere.</p>
          <p class="mb-4">Your security and satisfaction are our top priorities.</p>
          <div class="mb-3">
            <a href="mailto:info@payizi.io" class="text-white text-decoration-none me-3">
              <i class="bi bi-envelope"></i> info@payizi.io
            </a>
            <a href="https://wa.me/27652114047" target="_blank" class="text-white text-decoration-none">
              <i class="bi bi-whatsapp"></i> +27 65 2114 047
            </a>
          </div>
          <p class="text-muted small mb-0">
            Â© 2025 Payizi Global. All rights reserved.
          </p>
        </div>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  
  <!-- Form Validation Enhancement Script (Non-interfering) -->
  <script>
    console.log('ðŸ”§ Form validation enhancement loaded');

    // Country-specific validation patterns
    const VALIDATION_PATTERNS = {
      southAfrica: {
        mobile: /^(\+27|0)[6-8][0-9]{8}$/,
        formats: { mobile: '+27 XX XXX XXXX or 0XX XXX XXXX' }
      },
      zimbabwe: {
        mobile: /^(\+263|0)[7][0-9]{8}$/,
        // Enhanced ID validation patterns
        id: /^[0-9]{2}-[0-9]{6,7}[A-Z][0-9]{2}$/,
        passport: /^[A-Z]{2}[0-9]{6}$/,
        // Additional ID format variations
        idWithSpaces: /^[0-9]{2}\s?-\s?[0-9]{6,7}\s?[A-Z]\s?[0-9]{2}$/,
        passportWithSpaces: /^[A-Z]{2}\s?[0-9]{6}$/,
        formats: {
          mobile: '+263 7X XXX XXXX or 07X XXX XXXX',
          id: 'National ID: XX-XXXXXXX[A-Z]XX (e.g., 12-345678A90)',
          passport: 'Passport: XX000000 (2 letters + 6 numbers, e.g., AB123456)'
        }
      }
    };

    // Enhanced ID validation function
    function validateZimbabweanId(idValue) {
  if (!idValue) return { isValid: false, type: null, message: 'ID is required' };
  const cleaned = idValue.replace(/\s/g, '').toUpperCase();

  // Pattern for 6 or 7 digit National ID + letter + 2 digits
  const idPattern = /^[0-9]{2}-[0-9]{6,7}[A-Z][0-9]{2}$/;

  if (idPattern.test(cleaned)) {
    const parts = cleaned.split('-');
    if (parts.length === 2) {
      const district = parts[0];
      const validDistricts = [
        '01', '02', '03', '04', '05', '06', '07', '08', '09', '10',
        '11', '12', '13', '14', '15', '16', '17', '18', '19', '20',
        '21', '22', '23', '24', '25', '26', '27', '28', '29', '30',
        '31', '32', '33', '34', '35', '36', '37', '38', '39', '40',
        '41', '42', '43', '44', '45', '46', '47', '48', '49', '50',
        '51', '52', '53', '54', '55', '56', '57', '58', '59', '60',
        '61', '62', '63', '64', '65', '66', '67', '68', '69', '70',
        '71', '72', '73', '74', '75', '76', '77', '78', '79', '80'
      ];
      if (!validDistricts.includes(district)) {
        return { isValid: false, type: 'id', message: 'Invalid district code. Must be between 01-80.' };
      }
      return { isValid: true, type: 'id', message: 'Valid Zimbabwean National ID', cleaned };
    }
  }

  // Passport pattern stays unchanged
  if (/^[A-Z]{2}[0-9]{6}$/.test(cleaned)) {
    const letters = cleaned.substring(0, 2);
    const numbers = cleaned.substring(2);
    const invalidCombos = ['00', '11', '22', '33', '44', '55', '66', '77', '88', '99'];
    if (invalidCombos.includes(letters)) {
      return { isValid: false, type: 'passport', message: 'Invalid passport letter combination' };
    }
    return { isValid: true, type: 'passport', message: 'Valid Zimbabwean Passport', cleaned };
  }

  // Fallback error
  return {
    isValid: false,
    type: null,
    message: 'ID format is close but incorrect. Use: XX-XXXXXXX[A-Z]XX or XX-XXXXXX[A-Z]XX for National ID, or XX000000 for Passport'
  };
}
    // Enhanced validation functions with country-specific enforcement
    function enhanceFieldValidation() {
      // Add visual feedback to existing validation
      const fields = ['name', 'email', 'mobile', 'beneficiaryName', 'beneficiaryMobile', 'beneficiaryId', 'country', 'location', 'usdAmount'];
      
      fields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (!field) return;
        
        field.addEventListener('input', () => addVisualFeedback(fieldId));
        field.addEventListener('blur', () => addVisualFeedback(fieldId));
      });
    }

    function addVisualFeedback(fieldId) {
      const field = document.getElementById(fieldId);
      if (!field) return;
      
      const value = field.value.trim();
      let isValid = false;
      let errorMessage = '';
      
      // Basic validation with country-specific rules
      switch(fieldId) {
        case 'name':
        case 'beneficiaryName':
          isValid = value.length >= 2 && /^[a-zA-Z\s]+$/.test(value);
          if (!isValid && value.length > 0) {
            errorMessage = 'Name must contain only letters and spaces';
          }
          break;
        case 'email':
          isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
          if (!isValid && value.length > 0) {
            errorMessage = 'Please enter a valid email address';
          }
          break;
        case 'mobile':
          // ENFORCE: Customer mobile must be South African
          const cleanedSA = value.replace(/[\s\-\(\)]/g, '');
          isValid = VALIDATION_PATTERNS.southAfrica.mobile.test(cleanedSA);
          if (!isValid && value.length > 0) {
            errorMessage = 'Customer mobile must be a South African number (+27 XX XXX XXXX or 0XX XXX XXXX)';
          }
          break;
        case 'beneficiaryMobile':
          // ENFORCE: Beneficiary mobile must be Zimbabwean
          const cleanedZW = value.replace(/[\s\-\(\)]/g, '');
          isValid = VALIDATION_PATTERNS.zimbabwe.mobile.test(cleanedZW);
          if (!isValid && value.length > 0) {
            errorMessage = 'Beneficiary mobile must be a Zimbabwean number (+263 7X XXX XXXX or 07X XXX XXXX)';
          }
          break;
        case 'beneficiaryId':
          // Enhanced ID validation with detailed feedback
          const idValidation = validateZimbabweanId(value);
          isValid = idValidation.isValid;
          if (!isValid && value.length > 0) {
            errorMessage = idValidation.message;
          }
          break;
        case 'country':
        case 'location':
          isValid = value !== '';
          if (!isValid) {
            errorMessage = 'Please select an option';
          }
          break;
        case 'usdAmount':
          const amount = parseFloat(value);
          isValid = !isNaN(amount) && amount >= 5 && amount <= 10000;
          if (!isValid && value.length > 0) {
            errorMessage = 'Amount must be between $5 and $10,000';
          }
          break;
        default:
          isValid = value.length > 0;
      }
      
      // Update visual feedback
      field.classList.remove('is-valid', 'is-invalid');
      
      // Remove existing error message
      const existingError = field.parentNode.parentNode.querySelector('.error-message');
      if (existingError) {
        existingError.remove();
      }
      
      if (value && field.type !== 'submit') {
        field.classList.add(isValid ? 'is-valid' : 'is-invalid');
        
        // Add error message for invalid fields
        if (!isValid && errorMessage) {
          const errorDiv = document.createElement('div');
          errorDiv.className = 'error-message text-danger small mt-1';
          errorDiv.textContent = errorMessage;
          field.parentNode.parentNode.appendChild(errorDiv);
        }
      }
    }

    // Format mobile numbers as user types with country-specific validation
    function addMobileFormatting() {
      const mobileField = document.getElementById('mobile');
      const beneficiaryMobileField = document.getElementById('beneficiaryMobile');
      const beneficiaryIdField = document.getElementById('beneficiaryId');
      
      if (mobileField) {
        mobileField.addEventListener('input', function() {
          let value = this.value.replace(/\D/g, '');
          
          // Force South African format only
          if (value.startsWith('27')) {
            // +27 format
            if (value.length >= 11) {
              this.value = '+27 ' + value.slice(2, 4) + ' ' + value.slice(4, 7) + ' ' + value.slice(7, 11);
            } else if (value.length >= 4) {
              this.value = '+27 ' + value.slice(2, 4) + (value.length > 4 ? ' ' + value.slice(4, 7) : '') + (value.length > 7 ? ' ' + value.slice(7) : '');
            } else {
              this.value = '+27 ' + value.slice(2);
            }
          } else if (value.startsWith('0') && value.length >= 2) {
            // Local 0XX format
            if (value.length >= 10) {
              this.value = value.slice(0, 3) + ' ' + value.slice(3, 6) + ' ' + value.slice(6, 10);
            } else if (value.length >= 6) {
              this.value = value.slice(0, 3) + ' ' + value.slice(3, 6) + (value.length > 6 ? ' ' + value.slice(6) : '');
            } else if (value.length >= 3) {
              this.value = value.slice(0, 3) + (value.length > 3 ? ' ' + value.slice(3) : '');
            }
          } else if (!value.startsWith('27') && !value.startsWith('0') && value.length > 0) {
            // Auto-add +27 for other numbers
            this.value = '+27 ' + value;
          }
        });
        
        // Prevent non-South African numbers
        mobileField.addEventListener('blur', function() {
          const cleaned = this.value.replace(/[\s\-\(\)]/g, '');
          if (cleaned && !VALIDATION_PATTERNS.southAfrica.mobile.test(cleaned)) {
            // Show specific error for non-SA numbers
            this.setCustomValidity('Customer mobile number must be a South African number');
          } else {
            this.setCustomValidity('');
          }
        });
      }
      
      if (beneficiaryMobileField) {
        beneficiaryMobileField.addEventListener('input', function() {
          let value = this.value.replace(/\D/g, '');
          
          // Force Zimbabwean format only
          if (value.startsWith('263')) {
            // +263 format
            if (value.length >= 12) {
              this.value = '+263 ' + value.slice(3, 5) + ' ' + value.slice(5, 8) + ' ' + value.slice(8, 12);
            } else if (value.length >= 5) {
              this.value = '+263 ' + value.slice(3, 5) + (value.length > 5 ? ' ' + value.slice(5, 8) : '') + (value.length > 8 ? ' ' + value.slice(8) : '');
            } else {
              this.value = '+263 ' + value.slice(3);
            }
          } else if (value.startsWith('07') && value.length >= 3) {
            // Local 07X format
            if (value.length >= 10) {
              this.value = value.slice(0, 3) + ' ' + value.slice(3, 6) + ' ' + value.slice(6, 10);
            } else if (value.length >= 6) {
              this.value = value.slice(0, 3) + ' ' + value.slice(3, 6) + (value.length > 6 ? ' ' + value.slice(6) : '');
            } else if (value.length >= 3) {
              this.value = value.slice(0, 3) + (value.length > 3 ? ' ' + value.slice(3) : '');
            }
          } else if (value.startsWith('7') && value.length >= 2) {
            // Auto-add +263 for 7X numbers
            this.value = '+263 ' + value;
          } else if (!value.startsWith('263') && !value.startsWith('07') && !value.startsWith('7') && value.length > 0) {
            // Auto-add +263 for other numbers starting with valid Zim prefixes
            if (value.startsWith('77') || value.startsWith('78') || value.startsWith('71') || value.startsWith('73')) {
              this.value = '+263 ' + value;
            }
          }
        });
        
        // Prevent non-Zimbabwean numbers
        beneficiaryMobileField.addEventListener('blur', function() {
          const cleaned = this.value.replace(/[\s\-\(\)]/g, '');
          if (cleaned && !VALIDATION_PATTERNS.zimbabwe.mobile.test(cleaned)) {
            // Show specific error for non-ZW numbers
            this.setCustomValidity('Beneficiary mobile number must be a Zimbabwean number');
          } else {
            this.setCustomValidity('');
          }
        });
      }
      
      // Add ID number formatting
      if (beneficiaryIdField) {
  beneficiaryIdField.addEventListener('input', function () {
    const raw = this.value.toUpperCase().replace(/[^A-Z0-9]/g, '');

    // National ID if it starts with a digit
    if (/^\d/.test(raw)) {
      const district = raw.slice(0, 2).replace(/\D/g, '');
      const rest = raw.slice(2);

      let serial = '';
      let letter = '';
      let suffix = '';

      for (const ch of rest) {
        if (!letter) {
          if (/[0-9]/.test(ch)) {
            if (serial.length < 7) serial += ch; // grow serial up to 7
          } else if (/[A-Z]/.test(ch)) {
            // only allow letter once we have at least 6 serial digits
            if (serial.length >= 6) letter = ch;
          }
        } else {
          if (/[0-9]/.test(ch) && suffix.length < 2) suffix += ch;
        }
      }

      let out = district;
      if (serial.length) out += '-' + serial;
      if (letter) out += letter;
      if (suffix) out += suffix;

      this.value = out;
      return;
    }

    // Passport if it starts with a letter
    if (/^[A-Z]/.test(raw)) {
      const letters = raw.replace(/[^A-Z]/g, '').slice(0, 2);
      const nums = raw.replace(/[^0-9]/g, '').slice(0, 6);
      this.value = letters + nums;
      return;
    }
  });

        // Validate on blur
        beneficiaryIdField.addEventListener('blur', function() {
          const validation = validateZimbabweanId(this.value);
          if (this.value && !validation.isValid) {
            this.setCustomValidity(validation.message);
          } else {
            this.setCustomValidity('');
            // Update field with cleaned value if valid
            if (validation.isValid && validation.cleaned) {
              this.value = validation.cleaned;
            }
          }
        });
      }
    }

    // Initialize enhancements after DOM is ready but don't interfere with existing functionality
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(() => {
        enhanceFieldValidation();
        addMobileFormatting();
        addFormSubmissionValidation();
        console.log('âœ… Form validation enhancements with country validation initialized');
      }, 200); // Delay to ensure order.js loads first
    });

    // Add form submission validation to enforce country-specific mobile numbers and ID validation
    function addFormSubmissionValidation() {
      const form = document.getElementById('orderForm');
      if (form) {
        form.addEventListener('submit', function(e) {
          const mobileField = document.getElementById('mobile');
          const beneficiaryMobileField = document.getElementById('beneficiaryMobile');
          const beneficiaryIdField = document.getElementById('beneficiaryId');
          
          let hasErrors = false;
          let errorMessages = [];
          
          // Validate customer mobile (must be South African)
          if (mobileField && mobileField.value) {
            const cleanedSA = mobileField.value.replace(/[\s\-\(\)]/g, '');
            if (!VALIDATION_PATTERNS.southAfrica.mobile.test(cleanedSA)) {
              hasErrors = true;
              errorMessages.push('Customer mobile number must be a valid South African number (+27 XX XXX XXXX or 0XX XXX XXXX)');
              mobileField.classList.add('is-invalid');
            }
          }
          
          // Validate beneficiary mobile (must be Zimbabwean)
          if (beneficiaryMobileField && beneficiaryMobileField.value) {
            const cleanedZW = beneficiaryMobileField.value.replace(/[\s\-\(\)]/g, '');
            if (!VALIDATION_PATTERNS.zimbabwe.mobile.test(cleanedZW)) {
              hasErrors = true;
              errorMessages.push('Beneficiary mobile number must be a valid Zimbabwean number (+263 7X XXX XXXX or 07X XXX XXXX)');
              beneficiaryMobileField.classList.add('is-invalid');
            }
          }
          
          // Validate beneficiary ID (must be valid Zimbabwean ID or Passport)
          if (beneficiaryIdField && beneficiaryIdField.value) {
            const idValidation = validateZimbabweanId(beneficiaryIdField.value);
            if (!idValidation.isValid) {
              hasErrors = true;
              errorMessages.push('Beneficiary ID: ' + idValidation.message);
              beneficiaryIdField.classList.add('is-invalid');
            }
          }
          
          // Prevent form submission if there are validation errors
          if (hasErrors) {
            e.preventDefault();
            e.stopPropagation();
            
            // Show error alert
            alert('Please fix the following errors:\n\n' + errorMessages.join('\n\n'));
            
            // Focus on first invalid field
            const firstInvalid = form.querySelector('.is-invalid');
            if (firstInvalid) {
              firstInvalid.focus();
            }
            
            return false;
          }
        });
      }
    }
  </script>
  
  <!-- Load order.js BEFORE other scripts to avoid conflicts -->
  <script type="module" src="order.js"></script>
  
  <!-- Mobile Menu Toggle Script -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const navbarToggler = document.querySelector('.navbar-toggler-alt');
      const navbarNav = document.querySelector('.navbar-nav');
      
      if (navbarToggler && navbarNav) {
        navbarNav.classList.remove('show');
        navbarToggler.classList.add('collapsed');
        
        navbarToggler.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          navbarNav.classList.toggle('show');
          this.classList.toggle('collapsed');
        });
        
        document.addEventListener('click', function(event) {
          if (!navbarNav.contains(event.target) && !navbarToggler.contains(event.target)) {
            navbarNav.classList.remove('show');
            navbarToggler.classList.add('collapsed');
          }
        });
        
        document.querySelectorAll('.nav-link').forEach(link => {
          link.addEventListener('click', function() {
            if (window.innerWidth < 768) {
              navbarNav.classList.remove('show');
              navbarToggler.classList.add('collapsed');
            }
          }); 
        });
        
        window.addEventListener('resize', function() {
          if (window.innerWidth >= 768) {
            navbarNav.classList.remove('show');
            navbarToggler.classList.add('collapsed');
          }
        });
      }
    });
  </script>
</body>

</html>


